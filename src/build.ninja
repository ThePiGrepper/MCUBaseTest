#project specific variables
#external libraries
stlib = ../../STM32L0_StdPeriph_Lib
project_name = sample_project

#ninja make configuration
builddir = ../obj
tool = arm-none-eabi-gcc
cflags = -mcpu=cortex-m0plus -mlittle-endian -mthumb
deflst = -DSTM32L053xx
incdir =  -I./ $
          -I./include $
          -I$stlib/CMSIS/Core $
          -I$stlib/CMSIS/Device
#          -I$stlib/STM32L0xx_StdPeriph_Driver/inc $

cscript = -T../../linker_scripts/stm32l053r8.ld

rule OBJCOPY
  command = arm-none-eabi-objcopy -Oihex $in $out && arm-none-eabi-size $in
  description = Creating $out hexfile

rule CC
  depfile = $out.d
  deps = gcc
  command = $tool -MMD -MF $out.d  -g -Os -Wall -fdata-sections -ffunction-sections $cflags $incdir $deflst -c $in -o $out
  description = Compiling $in

rule CLINK
  command = $tool -g $cflags $deflst $cscript -Wl,--gc-sections $in -o $out
  description = Linking $out

build $builddir/main.o: CC main.c
build $builddir/stm32l0xx_it.o: CC stm32l0xx_it.c
build $builddir/system_stm32l0xx.o: CC system_stm32l0xx.c
#build $builddir/system_stm32l0xx.o: CC $stlib/CMSIS/Device/system_stm32l0xx.c
build $builddir/startup_stm32l053xx.o: CC $stlib/CMSIS/Device/startup/gcc/startup_stm32l053xx.s
#build $builddir/misc.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/misc.c
#build $builddir/stm32l0xx_exti.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_exti.c
#build $builddir/stm32l0xx_flash.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_flash.c
#build $builddir/stm32l0xx_rcc.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_rcc.c
#build $builddir/stm32l0xx_gpio.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_gpio.c
#build $builddir/stm32l0xx_dac.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_dac.c
#build $builddir/stm32l0xx_rtc.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_rtc.c
#build $builddir/stm32l0xx_adc.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_adc.c
#build $builddir/stm32l0xx_dbgmcu.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_dbgmcu.c
#build $builddir/stm32l0xx_sdio.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_sdio.c
#build $builddir/stm32l0xx_can.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_can.c
#build $builddir/stm32l0xx_spi.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_spi.c
#build $builddir/stm32l0xx_crc.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_crc.c
#build $builddir/stm32l0xx_dma.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_dma.c
#build $builddir/stm32l0xx_i2c.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_i2c.c
#build $builddir/stm32l0xx_iwdg.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_iwdg.c
#build $builddir/stm32l0xx_tim.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_tim.c
#build $builddir/stm32l0xx_pwr.o: CC $stlib/STM32F10x_StdPeriph_Driver/src/stm32l0xx_pwr.c
#build $builddir/stm32l0xx_usart.o: CC $stm32f10x_cryp/STM32F10x_StdPeriph_Driver/src/stm32l0xx_usart.c
#build $builddir/stm32l0xx_fsmc.o: CC $stm32f10x_pwr/STM32F10x_StdPeriph_Driver/src/stm32l0xx_fsmc.c
#build $builddir/stm32l0xx_wwdg.o: CC $stm32f10x_cryp_des/STM32F10x_StdPeriph_Driver/src/stm32l0xx_wwdg.c

build $builddir/$project_name.elf: CLINK $builddir/main.o $
                                      $builddir/stm32l0xx_it.o $
                                      $builddir/system_stm32l0xx.o $
                                      $builddir/startup_stm32l053xx.o $

build $builddir/$project_name.hex: OBJCOPY $builddir/$project_name.elf
default $builddir/$project_name.hex
